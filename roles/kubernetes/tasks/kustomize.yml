---

- name: Check that kustomize exists
  stat:
    path: /usr/local/bin/kustomize
  register: stat_result
- name: Get latest release of kustomize
  github_release:
    token: "{{ github_repos_public_mrdon }}"
    user: kubernetes-sigs
    repo: kustomize
    action: latest_release
  when: stat_result.stat.exists == False
  register: kustomize_release
- name: Download latest kustomize release
  become: yes
  become_user: root
  get_url:
    url: "https://github.com/kubernetes-sigs/kustomize/releases/download/{{ kustomize_release.tag}}/kustomize_{{ kustomize_release.tag[1:] }}_linux_amd64"
    dest: /usr/local/bin/kustomize
    mode: 755
  when: stat_result.stat.exists == False
